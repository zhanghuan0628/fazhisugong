<!doctype html>
<html>    <head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width,initial-scale=1.0">
 <script src="../assets/js/jquery/jquery.min.js"></script>
 <script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
 <style type="text/css">
         .wxtip {
             background: rgba(0,0,0,0.8);
             text-align: center;
             position: fixed;
             left: 0;
             top: 0;
             width: 100%;
             height: 100%;
             z-index: 998;
             display: none;
         }
        
         .wxtip-icon {
             width: 52px;
             height: 67px;
             background: url(/images/newVersion/weixin-tip.png) no-repeat;
             display: block;
             position: absolute;
             right: 30px;
             top: 20px;
             z-index: 999;
         }
         .wxtip-txt {
             padding-top: 107px;
             color: #fff;
             font-size: 16px;
             line-height: 1.5;
         }
     </style>
 </head>
 <body>
     <div class="wxtip" id="weixinTip">
         <span class="wxtip-icon" id="weixinIcon"></span>
         <p class="wxtip-txt">万心社<br/>IOS测试版</p>
     </div>

 <script language="javascript">
            window.onload = function() {
                var u = navigator.userAgent,flag;

                if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) { //安卓手机
                	                	alert("您好，万心社演示版暂不支持 Android 手机 ，请使用 iOS 手机下载体验。");
					                    
                } else if (u.indexOf('iPhone') > -1) { //苹果手机
                	                    flag=true;
                    window.location.href = "itms-services://?action=download-manifest&url=https://feifanxinli.com/assets/app/wxs//manifest.plist";
                                    } else if (u.indexOf('Windows Phone') > -1) { //winphone手机
                    alert("WindowsPhone暂未推出。");
                }else{
                // else if (u.indexOf('Windows NT') > -1) { //Windows电脑
                    //alert("请用手机浏览器访问。");
                    $.ajax({
                    	  type: 'GET',
                    	  url: '?from=web',
                    	  dataType: 'html',
                    	  success: function(data){
							  $("body").html(data);
                    	  }
                    });
                }

                
                if(flag){
                    var isWeixin = !!/MicroMessenger/i.test(u);
                    if (isWeixin) {
                        document.getElementById('weixinTip').style.display='block';
                        document.getElementById('weixinIcon').style.display='block';
                    }
                }
                
                var apiUrl = location.protocol+"//"+window.location.host+"/ffyy_api";
                locationUrl = apiUrl+"/fx/downloadAppAll3.html?";
     			wxtitle = "万心社APP(IOS)测试版发布了，快来下载体验吧";
     			wximgUrl= apiUrl+"/assets/images/logo.png";
     			wxdesc = "测试版需要提前获知IOS手机的设备号，如果没有安装成功，赶紧联系程序员小哥哥帮你诊断一下吧";
     			wxShare(apiUrl,locationUrl,wxtitle,wximgUrl,wxdesc);
     			
            };

            
            
//			微信分享
			function wxShare(apiUrl,locationUrl,wxtitle,wximgUrl,wxdesc){
				//分享配置
			    $.ajax({
			        type: "POST",
			        url : apiUrl+"/jssdk/get_config_param",
			        data: {requesUrl:location.href.split('#')[0]},
			        dataType:'json',
			        async:false,
			        success: function(data){
			        	console.log(data.code);
			            if(data.code == '2000'){
			                var appId = data.data.appId;
			                var timestamp = data.data.timestamp;
			                var nonceStr = data.data.nonceStr;
			                var signature = data.data.signature;
			    			console.log(appId)
			                wx.config({
			                    debug: false,  
			                    appId: appId,  
			                    timestamp: timestamp,  
			                    nonceStr: nonceStr,  
			                    signature: signature,  
			                    jsApiList: ['onMenuShareTimeline',
			                                'onMenuShareAppMessage',
			                                'onMenuShareQQ',
			                                'onMenuShareQZone']  
			                });  
			                wx.ready(function () {
			                    wx.checkJsApi({
			                        jsApiList: ['onMenuShareTimeline',
			                                    'onMenuShareAppMessage',
			                                    'onMenuShareQQ',
			                                    'onMenuShareQZone']  , 
			                        success: function(res) {
			                            console.log(JSON.stringify(res));
			                        }
			                    });
			                    //分享到朋友圈
			                    wx.onMenuShareTimeline({
			                        title: wxtitle, // 分享标题
			                        imgUrl: wximgUrl, // 分享图标
			                        desc: wxdesc, // 分享描述
			                        link:locationUrl,
			                        success: function () {},
			                        cancel: function () {}
			                    });
			                    //分享给朋友
			                    wx.onMenuShareAppMessage({
			                        title: wxtitle, // 分享标题
			                        imgUrl: wximgUrl, // 分享图标
			                        desc: wxdesc, // 分享描述
			                        link:locationUrl,
			                        success: function () {},
			                        cancel: function () {}
			                    });
			                    //分享到QQ
			                    wx.onMenuShareQQ({
			                        title: wxtitle, // 分享标题
			                        imgUrl: wximgUrl, // 分享图标
			                        desc: wxdesc, // 分享描述
			                        link:locationUrl,
			                        success: function () {},
			                        cancel: function () {}
			                    });
			                    //分享到QQ空间
			                    wx.onMenuShareQZone({
			                        title: wxtitle, // 分享标题
			                        imgUrl: wximgUrl, // 分享图标
			                        desc: wxdesc, // 分享描述
			                        link:locationUrl,
			                        success: function () {},
			                        cancel: function () {}
			                    });
			                    wx.error(function(res){
			                        //alert("errorMSG:"+res);
			                    });
			                });
			            }else{
			                alert(data.message);
			            }
			        },
			        error:function(response, status, err){
			            //alert("系统异常");
			        }
			    }); 
			}
        </script>
        </body></html>