<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<title>话题详情-飞小凡</title>
	<link rel="stylesheet" href="css/index.css"/>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
	<script src="js/jquery.min.js"></script>

</head>
<body>
<div class="floor">
	<!--<div class="fclose"><img src="../resources/fxf/news-cou-icon1.png"></div>-->
	<div class="flogo"><img src="images/108.png"></div>
	<div class="yanzi">最懂你的青少年心理交流社区</div>
	<a href="#" onclick="more()">下载App </a>
</div>
<div class="content_div">
	<div class="headdiv">
		<div class="hhdimg"><img id="hdimg" src="images/headurl.png"></div>
		<span class="tname"></span>
		<span class="tshij"></span>
	</div>
	<div id="contentt"  class="contentt">
		
	</div>
	<div id="bckimg" ></div>
	<div class="pinlun">全部评论</div>
	<div id="ans">
	<div class="answeror">
		<div class="aor">
			<img src="images/headurl.png">
		</div>
		<div class="adate">
			<div>花开半夏</div>
			<div>2017.5</div>
		</div>
		<div class="xzz">
			<img src="images/xzan.png" class="i1">
			<span  class="i2">123</span>
			<img src="images/xxin.png"  class="i3">
			<span class="i4">123</span>
		</div>
		
	</div>
	<div class="aconts">
			从你的全世界路过
		</div>
	<div class="beansc">
		<div><span>楼主</span>回复<span>花开_半夏</span>：只要最后是你，就好。</div>
		<div><span>楼主</span>回复<span>花开_半夏</span>：只要最后是你，就好。</div>
	</div>
	</div>
	<div class="more" onclick="more()"><a href="#" >更多</a></div>
</div>

<script type="text/javascript">
document.documentElement.style.fontSize = window.innerWidth/7.5 + 'px';
var title = "";
var photo="";
var content ="";
$.ajax({
	   url : '../fxf_share/get_topics',
	data:{id:getQueryString("id") },
	success:function(res){
		console.log(res) 
	    var data = eval(res.data);
        var info = data.topic; //话题详情
        var answerList = data.answerList;//评论
        title = info.title; //分享使用
        var reTag = /<(?:.|\s)*?>/g;
        content = info.content.replace(reTag,"");//分享使用
		$("#hdimg").attr("src","../resources/fxf/headImg/"+info.headImg+".png");
		$('.tname').html(info.nickName);
		$('.tshij').html(formatData(info.createDate));
		
		$(".contentt").html(info.content);
		if(info.img.split(",")[0].length>0){
			var il = "";
			var imgList = info.img.split(",");
			for (var i=0;i<imgList.length;i++) {
				il += "<img src='"+imgList[i]+"'>";
			};
			$("#bckimg").html("<div class='bck_img'>"+il+"</div>");
	        photo=  info.img.split(",")[0];
		}else{
		        photo ="http://ffxl.oss-cn-shanghai.aliyuncs.com/fxf/app/108.png";
		    }
		
        //评论及回答
          var answers='';
		  $.each(answerList, function(i,item) {
		  	var replyList = item.childList;
		  	var reply = "";
		  	$.each(replyList, function(j,point) {
		  		reply += "<div><span>"+point.nickName+"</span>回复<span>"+point.dotoName+"</span>："+point.content+"</div>"
		  	});
		  	
		  	var replyH = "";
		  	if (replyList.length>0) {
		  		replyH = "<div class='beansc'>"+reply+"</div>";
		  	}
		  	
		  	var headImg = "";
		  	if (item.headImg!=null||item.headImg!="") {
		  		headImg=item.headImg
		  	} else{
		  		headImg="http://ffxl.oss-cn-shanghai.aliyuncs.com/fxf/app/roleHead/default.png";
		  	}
		  	
			answers += "<div class='answeror'>"+
				"<div class='aor'>"+
					"<img src='"+headImg+"'>"+
				"</div>"+
				"<div class='adate'>"+
					"<div>"+item.nickName+"</div>"+
					"<div>"+formatData(item.answerDate)+"</div>"+
				"</div>"+
				"<div class='xzz'>"+
					"<img src='images/xzan.png' class='i1'>"+
					"<span  class='i2'>"+item.praises+"</span>"+
					"<img src='images/xxin.png'  class='i3'>"+
					"<span class='i4'>"+item.childList.length+"</span>"+
				"</div>"+
			"</div>"+
			"<div class='aconts'>"+item.content+"</div>"+replyH;
		  });
          
//        answerList.forEach(function (answer) {
//            answers+='<div class="answeror"><div class="aor">'
//            answers+='<img src="'+answer.headImg+'">'
//            answers+='</div>'
//            answers+='<div class="adate">'
//                    answers+='<div>'+answer.nickName+'</div>'
//                    answers+='<div>'+ formatData(answer.answerDate)+'</div>'
//            answers+='</div>'
//            answers+='<div class="xzz">'
//                    answers+='<img src="images/xzan.png" class="i1">'
//                    answers+='<span  class="i2">'+answer.praises+'</span>'
//                    answers+='<img src="images/xxin.png"  class="i3">'
//                    answers+=' <span class="i4">'+answer.childList.length+'</span></div></div>'
//          });
          $("#ans").html(answers);
        //分享
          var id =getQueryString("id") ;
          share(id)
	}
})
function formatData(date1){
      var date = new Date(date1) 
      return date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
    }

function share(id){
    //alert(photo);
    $.ajax({
        type: "POST",
        url : "../jssdk/get_config_param",
        data: {
            requesUrl : location.href.split('#')[0]
            },
        dataType:'json',
        async:false,
        success: function(data){
            console.log(data.data);
            if(data.code == '2000'){    
                console.log(data.data.appId);
                var appId = data.data.appId;
                var timestamp = data.data.timestamp;
                var nonceStr = data.data.nonceStr;
                var signature = data.data.signature;
                
                //alert(appId+"】"+timestamp+"】"+nonceStr+"】"+signature);
                wx.config({
                    debug: false,  
                    appId: appId,  
                    timestamp: timestamp,  
                    nonceStr: nonceStr,  
                    signature: signature,  
                    jsApiList: ['onMenuShareTimeline',
                                'onMenuShareAppMessage',
                                'onMenuShareQQ',
                                'onMenuShareWeibo',
                                'onMenuShareQZone']  
                    });  
                
                wx.ready(function () {
                    wx.checkJsApi({
                        jsApiList: ['onMenuShareTimeline',
                                    'onMenuShareAppMessage',
                                    'onMenuShareQQ',
                                    'onMenuShareWeibo',
                                    'onMenuShareQZone']  , 
                        success: function(res) {
                            console.log(JSON.stringify(res));
                        }
                    });

                    //分享到朋友圈
                    wx.onMenuShareTimeline({
                          title: title, // 分享标题
                          link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/topic.html?id="+id,
                          imgUrl: photo, // 分享图标
                          desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                    //分享给朋友
                    wx.onMenuShareAppMessage({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/topic.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {
                          alert(name+" ----"+title);
                        }
                    });
                    //分享到QQ
                    wx.onMenuShareQQ({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/topic.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                    //分享到QQ空间
                    wx.onMenuShareQZone({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/topic.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                                        
                    
                    wx.error(function(res){
                        alert("errorMSG:"+res);
                    });
                });
            }else{
                alert(data.message);
            }
        },
        error:function(response, status, err){
            //alert("系统异常");
        }
    });
  }      
</script>
</body>
</html>