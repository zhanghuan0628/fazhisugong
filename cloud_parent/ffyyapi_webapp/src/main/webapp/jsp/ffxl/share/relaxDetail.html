<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>正念详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/global.css?v=1"/>
		<link rel="stylesheet" type="text/css" href="css/class.css"/>
	</head>
	<body style="padding-bottom: 4.9rem;">
		<div class="classDetail">
			<a class="closeClassDetail"></a>
			<div>

			</div>
		</div>

		<div id="downLoadLine">
			<img src="images/wxLogo.png"/>
			<a onclick="more()">下载APP</a>
		</div>
		
		<div class="audioClass">
			<em></em>
			<h1>课程名称</h1>
			<div>
				<p></p>
				<a>查看更多</a>
			</div>
		</div>


		<div class="classData">
			<div>
				<h1>课程</h1>
				<p><span>12</span>个</p>
			</div>
			<div>
				<h1>总时长</h1>
				<p><span>12</span>分钟</p>
			</div>
			<div>
				<h1>参加人数</h1>
				<p><span>12</span>人</p>
			</div>
		</div>


		<div class="classList">
			<h1 class="classTitle">课程列表</h1>
			<ul>
				<!-- <li>
					<i>1</i>
					<h1>把心唤醒</h1>
					<p>19:00</p>
					<span>试听</span>
					<em></em>
				</li>
				<li>
					<i>2</i>
					<h1>把心唤醒</h1>
					<p>19:00</p>
					<span>试听</span>
					<em></em>
				</li>
				<li class="classLock">
					<i>3</i>
					<h1>把心唤醒</h1>
					<p>19:00</p>
					<em></em>
				</li> -->
			</ul>
		</div>
		
		<div class="classComment">
			<h1 class="classTitle">课程评论<a>评论</a></h1>
			<ul>
				<!-- <li>
					<img class="commentHead" src="" alt="">
					<p class="commentName">奔跑的小绵羊</p>
					<p class="commentTime">12:02</p>
					<p class="praiseNum">2</p>
					<div class="commentCont">
						<p>我爸妈天天晚上都特别晚回家，我一个人在家怕，是不知道和谁说，他们好像一点都不关心我在家怕，可是不知道和谁说，他们好像一点都不关心。</p>
					</div>
				</li> -->
			</ul>
		</div>
				
		
		


		<div class="classBottom">
			
		</div>
		
		
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="js/index.js?v=20180115" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

			function relaxDetail(id){
				$.ajax({
			        url: apiUrl+"/sce_homepage/sce_fm_courses",
			        type: "post",
			        data: {id:id},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data[0];
								
								$(".audioClass").css("background-image","url("+data.img+")");
								$(".audioClass h1").text(data.coursesName);

								var reTag = /<(?:.|\s)*?>/g;
								var shortCont = data.detail.replace(reTag,"");
								$(".audioClass p").text(shortCont);

								$(".classDetail div").html(data.detail);

								$(".classData div").eq(0).find("p span").text(data.totalLess);
								$(".classData div").eq(1).find("p span").text(data.totalDuration);
								$(".classData div").eq(2).find("p span").text(data.readCount);

								$(".classBottom").html("<span>"+data.discountPrice+"</span>元/"+data.totalLess+"节")

								locationUrl = apiUrl+"/jsp/ffxl/share/relaxDetail.html?id="+id;
								wxtitle = "我从万心社推荐一门有用的正念课程给你："+data.coursesName;
								wximgUrl= data.img;
								wxdesc = shortCont;
								wxShare(locationUrl,wxtitle,wximgUrl,wxdesc);
			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			function relaxClassList(coursesId){
				$.ajax({
			        url: apiUrl+"/sce_homepage/fm_list",
			        type: "post",
			        data: {coursesId:coursesId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								var html = "";

								$.each(data, function(i,item) {
									var isLock = "";
									var listen = "<span>试听</span>";
									if (i > 1) {
										isLock = "classLock";
										listen = "";
									}
									
									var sortNum = i+1;

									var during = "";
									if (item.during != null) {
										during = item.during;
									}

									html += "<li class='"+isLock+"' data-id='"+item.id+"'>"+
										"<i>"+sortNum+"</i>"+
										"<h1>"+item.title+"</h1>"+
										"<p>"+during+"</p>"+listen+
										"<em></em>"+
									"</li>";
								});

								$(".classList ul").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			// 评论
			function commentList(sourceId){
				$.ajax({
			        url: apiUrl+"/ambitus/active_estimate_list",
			        type: "post",
			        data: {sourceId:sourceId,sourceType:"fm"},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								
								var html = "";
								$.each(data, function(i,item) {

									var time = ""
									var differTime = new Date().getTime()-item.estimateDatetime;
									if (differTime<=86400000) {
										var hours = parseInt(differTime / 1000 / 60 / 60 % 24 , 10); //计算剩余的小时 
										var minutes = parseInt(differTime / 1000 / 60 % 60, 10);//计算剩余的分钟 
										
										if (hours!=0) {
											time = hours+"小时前";
										} else if (minutes!=0) {
											time = minutes+"分钟前";
										} else {
											time = "1分钟前"
										}
									} else {
										var obj = new Date(item.estimateDatetime);
										// var oYear = obj.getFullYear();
										// var oMonth = obj.getMonth()+1;
										// var oDate = obj.getDate();
										var oHour = obj.getHours();
										var oMinute = obj.getMinutes();
										
										// time = oYear+"."+getzf(oMonth)+"."+getzf(oDate)+" "+getzf(oHour)+":"+getzf(oMinute);
										time = getzf(oHour)+":"+getzf(oMinute);
									}

									var headUrl = "";
									var name = "";
									if (item.see) {
										headUrl = apiUrl+"/jsp/ffxl/share/images/anonymous.png";
										name = "匿名用户"
									} else {
										headUrl = item.uHeadUrl;
										name = item.uName;
									}
						
									html += "<li>"+
										"<img class='commentHead' src='"+headUrl+"' />"+
										"<p class='commentName'>"+name+"</p>"+
										"<p class='commentTime'>"+time+"</p>"+
										"<p class='praiseNum'>"+item.pCount+"</p>"+
										"<div class='commentCont'>"+
											"<p>"+item.content+"</p>"+
										"</div>"+
									"</li>";
								});

								$(".classComment ul").html(html);
			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			var locationUrl = "";
			var wxtitle = "";
			var wximgUrl = "";
			var wxdesc = "";
			
			$(function(){
				var id = getQueryString("id");
				relaxDetail(id);
				relaxClassList(id);
				commentList(id);


				$(".classList").on("click","li",function(){
					if (!$(this).hasClass("classLock")) {
						var relaxId = $(this).data("id");
						location.href="playRelax.html?coursesId="+id+"&id="+relaxId;
					}
					
				});

				$(".audioClass div a").click(function(){
					$(".classDetail").show();
				});

				$(".classDetail .closeClassDetail").click(function(){
					$(".classDetail").hide();
				})

				$("body").on("click",".classLock,.praiseNum,.classBottom,.classTitle a",function(){
					more();
				})
			})
		</script>
	</body>
</html>
