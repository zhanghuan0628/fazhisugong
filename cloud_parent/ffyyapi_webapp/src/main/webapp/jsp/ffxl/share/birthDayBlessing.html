<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>生日祝福</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/global.css?v=1"/>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
	</head>
	<body>
		<div id="downLoadLine">
			<img src="images/wxLogo.png"/>
			<a onclick="more()">下载APP</a>
		</div>
		
		<div class="birthDayBlessing">
			<div class="birthInfo">
				<div class="birthHead">
					<img src="" alt="">
					<em></em>
				</div>
				<div class="birthUser">
					<p class="birthName">王元</p>
					<p class="birthDay"><span>5月10日</span><i>白羊座</i></p>
					<p class="birthHint">5天后是他的生日</p>
				</div>

				<div class="birthGift">
					<img src="images/birthGift.png" alt="">
					<p>发红包送祝福</p>
				</div>
			</div>


			<div class="wordBlessings">
				<h1 class="birthTitle"><span>送文字祝福</span></h1>

				<p>点击你想送出的祝福语即可</p>

				<ul class="clearfix">
					<!-- <li>永远年轻永远热泪盈眶</li>
					<li>身体棒棒哒</li>
					<li>转角遇到爱</li>
					<li>前途无量</li>
					<li>数钱数到手软</li> -->
				</ul>

				<a>换一批</a>
			</div>

			<div class="voiceBlessings">
				<h1 class="birthTitle"><span>送语音祝福</span></h1>

				<img src="images/birthRecord.png" alt="">
				<div>
					<h2>点击图标开始录音</h2>
					<p>录音最长3分钟</p>
				</div>
			</div>

			<div class="trendsBlessings">
				<h1 class="birthTitle"><span>动态祝福</span></h1>

				<ul class="trendsList">
					<!-- <li>
						<img src="" alt="">
						<p class="blessName">张赫</p>
						<p class="blessType">送上文字祝福</p>
						<p class="blessDate">2018-05-10 12:20:35</p>

					</li> -->
				</ul>
			</div>

		</div>
		
		
		
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="js/index.js?v=20180115" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

			// 生日详情
			function userBirthDayDetail(beUserId){
				$.ajax({
			        url: apiUrl+"/b_user_wish/userBirthDayDetail",
			        type: "post",
			        data: {beUserId:beUserId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								$(".birthInfo .birthHead img").attr("src",data.headUrl);
								$(".birthInfo .birthUser .birthName").text(data.realName);
								var birthDay = data.bDay.split("-");
								$(".birthInfo .birthUser .birthDay span").text(parseInt(birthDay[1])+"月"+parseInt(birthDay[2])+"日");
								$(".birthInfo .birthUser .birthDay i").text(data.star);
								$(".birthInfo .birthUser .birthHint").text(data.birthdayCode+"天后是他的生日");

								locationUrl = apiUrl+"/jsp/ffxl/share/birthDayBlessing.html?beUserId="+beUserId;
								wxtitle = "来给"+data.birthName+"送上生日祝福吧！";
								wximgUrl= apiUrl+"/jsp/ffxl/share/images/wxShare.png";
								wxdesc = data.birthName+"会在生日当天收到祝福";
								wxShare(locationUrl,wxtitle,wximgUrl,wxdesc);
			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			// 文字祝福列表
			function wordBlessingsList(beUserId){
				$.ajax({
			        url: apiUrl+"/bwish/queryTypeList",
			        type: "post",
			        data: {type:"text",beUserId:beUserId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								
								var html = "";
								$.each(data, function(i,item) {
									var blessNum = "";
									if (item.num != 0) {
										blessNum = "<i>"+item.num+"</i>";
									}
									html += "<li>"+item.wishContent+blessNum+"</li>";
								})

								$(".wordBlessings ul").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			// 祝福动态列表
			function trendsList(beUserId){
				$.ajax({
			        url: apiUrl+"/b_user_wish/queryBUserWishList",
			        type: "post",
			        data: {beUserId:beUserId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								
								var html = "";
								$.each(data.dataList, function(i,item) {
									var blessType = "";
									var blessContent = "";
									if (item.wishType == "text") {
										blessType = "送上文字祝福";
										blessContent = "<p class='wordBless'>"+item.wishContent+"</p>";
									} else if (item.wishType == "voice") {
										blessType = "送上语音祝福";
										blessContent = "<div class='voiceBless'><em></em><p>"+item.voiceTime+"''</p></div>";
									} else if (item.wishType == "redPacket") {
										blessType = "送上红包";
										blessContent = "<img class='redPacket' src='images/redPacket.png' />";
									}

									var obj = new Date(item.sendDate);
									var oYear = obj.getFullYear();
									var oMonth = obj.getMonth()+1;
									var oDate = obj.getDate();
									var oHour = obj.getHours();
									var oMinute = obj.getMinutes();
									
									time = oYear+"."+getzf(oMonth)+"."+getzf(oDate)+" "+getzf(oHour)+":"+getzf(oMinute);

									html += "<li>"+
										"<img class='blessHead' src='"+item.fromUserheadUrl+"' />"+
										"<p class='blessName'>"+item.fromUserName+"</p>"+
										"<p class='blessType'>"+blessType+"</p>"+
										"<p class='blessDate'>"+time+"</p>"+blessContent+
									"</li>";
								})

								$(".trendsList").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			
			var locationUrl = "";
			var wxtitle = "";
			var wximgUrl = "";
			var wxdesc = "";
			
			$(function(){
				var beUserId = getQueryString("beUserId");
				userBirthDayDetail(beUserId);
				wordBlessingsList(beUserId);
				trendsList(beUserId);
				
				$(".wordBlessings a").click(function(){
					wordBlessingsList(beUserId);
				})

				$("body").on("click",".birthGift,.wordBlessings ul li,.voiceBlessings img,.trendsList .voiceBless em,.trendsList .redPacket",function(){
					more();
				})
			})
		</script>
	</body>
</html>
