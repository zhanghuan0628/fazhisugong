
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>连载文章</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/global.css?v=1"/>
		<link rel="stylesheet" type="text/css" href="css/article.css"/>
	</head>
	<body style="padding-bottom: 5.3rem;">

		<div id="layer"></div>

		<div class="serializeArticle">
			<h1 class="serializeArticleTitle"></h1>
			<p class="serializeArticleDate"></p>

			<div class="serializeArticleCont"></div>

			<div class="prevNext">
			</div>
			
		</div>

		<div class="serializeBottom">
			<a class="sb-listBtn">
				<span>列表</span>
			</a>
			<a class="sb-read">
				<span>2457</span>
			</a>
			<a class="sb-praise">
				<span>5217</span>
			</a>
		</div>


		<div class="serializeList sl-pop">
			<h1><em></em><span>已更新25章</span><a>正序/倒序</a></h1>
			<ul>
				<!-- <li>
					<h2>第二十五章 酿造梨酒的女孩</h2>
					<p class="sl-date">2018-03-23</p>
					<p class="sl-read">2485</p>
				</li> -->
				
			</ul>
			<a class="close-sl">关闭</a>
		</div>
		

		
		
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/index.js?v=20180423" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function detail(id,articleId){
				$.ajax({
			        url: apiUrl+"/api_article/detail",
			        type: "post",
			        data: {id:articleId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
			                	
			                	$(".serializeArticle .serializeArticleTitle").text(data.title);
			                	
			                	var time = ""
			                		
		                		var obj = new Date(data.createDate);
		                		var oYear = obj.getFullYear();
		                		var oMonth = obj.getMonth()+1;
		                		var oDate = obj.getDate();
		                		
	                			time = oYear+"-"+getzf(oMonth)+"-"+getzf(oDate);
			                	
			                	$(".serializeArticle .serializeArticleDate").text("发表于："+time);
			                	
			                	var imgUrl = "";
			                	if (data.imgUrl!=null && data.imgUrl!="") {
			                		imgUrl = "<img class='articleImg' src='"+data.imgUrl+"'>";
			                	}
			                	
			                	$(".serializeArticle .serializeArticleCont").html(imgUrl+data.content);
			                	
			                	
				                	
			                	
			                	var prevNext = "";
								for (var i=0;i<2;i++) {
									if (i==0) {
										if (data.serializeList[0].tag=="not") {
											prevNext += "<a class='serializeArticlePrev'>< 已经是第一章</a>"
										} else {
											prevNext += "<a class='serializeArticlePrev'>< 前一章</a>"
										}
									} else {
										if (data.serializeList[1].tag=="not") {
											prevNext += "<a class='serializeArticleNext'>即将更新 ></a>"
										} else {
											prevNext += "<a class='serializeArticleNext'>后一章 ></a>"
										}
									}
								}
								
								$(".prevNext").html(prevNext);

								$(".sb-read span").text(data.readCount);
								$(".sb-praise span").text(data.supportCount);


								locationUrl = apiUrl+"/jsp/ffxl/share/serializeArticleDetail.html?id="+id+"&articleId="+articleId;
								wxtitle = data.title;
								wximgUrl= data.imgUrl;
								wxdesc = data.content;
								wxShare(locationUrl,wxtitle,wximgUrl,wxdesc);
								
			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			function serializeArticleList(id){
				$.ajax({
			        url: apiUrl+"/api_article/all_serial_article",
			        type: "post",
			        data: {id:id,orderByPage:"asc"},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;

								serializList = data;

								serializNum = data.length;

								$(".serializeList h1 span").text("已更新"+serializNum+"章");

								var html = "";

								$.each(data, function(i,item) {
									var articleLock = "";
									if (i > 1) {
										articleLock = "articleLock"
									}
									html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
										"<h2>"+item.title+"</h2>"+
										"<p class='sl-date'>2018-03-23</p>"+
										"<p class='sl-read'>2485</p>"+
									"</li>";
								});

								$(".serializeList ul").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			var orderByPage = "asc";
			
			var serializList = []; 
			var serializNum = 0;

			$(function(){
				var id = getQueryString("id");
				var articleId = getQueryString("articleId");
				detail(id,articleId);
				serializeArticleList(id);
				
				$(".sb-listBtn").click(function(){
					$("#layer").show();
					$(".sl-pop").animate({"bottom":0});
				})

				$(".close-sl").click(function(){
					$("#layer").hide();
					$(".sl-pop").animate({"bottom":"-45.2rem"});
				})


				$(".serializeList h1 a").click(function(){
					serializList.reverse();
					var html = "";

					if (orderByPage == "asc") {
						$.each(serializList, function(i,item) {
							var articleLock = "";
							if (i != serializNum-1 && i != serializNum-2) {
								articleLock = "articleLock"
							}
							html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
								"<h2>"+item.title+"</h2>"+
								"<p class='sl-date'>2018-03-23</p>"+
								"<p class='sl-read'>2485</p>"+
							"</li>";
						});
						orderByPage = "desc";
					} else {
						$.each(serializList, function(i,item) {
							var articleLock = "";
							if (i > 1) {
								articleLock = "articleLock"
							}
							html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
								"<h2>"+item.title+"</h2>"+
								"<p class='sl-date'>2018-03-23</p>"+
								"<p class='sl-read'>2485</p>"+
							"</li>";
						});
						orderByPage = "asc";
					}

					$(".serializeList ul").html(html);
				})


				$("body").on("click",".sb-read,.sb-praise,.serializeList ul li,.prevNext a",function(){
					more();
				})
				
			})
		</script>
	</body>
</html>
