<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>连载文章</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/global.css?v=1"/>
		<link rel="stylesheet" type="text/css" href="css/article.css"/>
	</head>
	<body>
		<div id="downLoadLine">
			<img src="images/wxLogo.png"/>
			<a onclick="more()">下载APP</a>
		</div>
		
		<div class="serializeArticleCover">
			<div>
				<p class="readNum">2787</p>
				<p class="praiseNum">5426</p>
			</div>
		</div>

		<div class="serializeArticleDetail">
			<h1></h1>
			<span></span>
			<a>APP打开</a>
			<div>
				<p></p>
			</div>
		</div>

		<div class="serializeList">
			<h1><em></em><span>已更新25章</span><a>正序/倒序</a></h1>
			<ul>
				<!-- <li>
					<h2>第二十五章 酿造梨酒的女孩</h2>
					<p class="sl-date">2018-03-23</p>
					<p class="sl-read">2485</p>
				</li> -->
			</ul>
		</div>
		
		
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="js/index.js?v=20180115" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

			function serializeArticleInfo(id){
				$.ajax({
			        url: apiUrl+"/sce_homepage/uptodate_Serialize",
			        type: "post",
			        data: {id:id},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;
								$(".serializeArticleCover").css("background-image","url("+data.img+")");
								$(".serializeArticleCover div .readNum").text(data.readCount);
								$(".serializeArticleCover div .praiseNum").text(data.pariseCount);
								
								$(".serializeArticleDetail h1").text(data.title);
								$(".serializeArticleDetail span").text("作者："+data.author);
								$(".serializeArticleDetail div p").html("<i>内容简介：</i>"+data.summary);

								var content = $(".serializeArticleDetail div p");
								var rowNum = Math.round(content.height()/parseFloat(content.css('line-height')));
								if (rowNum>4) {
									$(".serializeArticleDetail div p").addClass('retract').after("<a>展开</a>");
								}


								locationUrl = apiUrl+"/jsp/ffxl/share/serializeArticle.html?id="+id;
								wxtitle = data.title;
								wximgUrl= data.img;
								wxdesc = data.summary;
								wxShare(locationUrl,wxtitle,wximgUrl,wxdesc);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			function serializeArticleList(id){
				$.ajax({
			        url: apiUrl+"/api_article/all_serial_article",
			        type: "post",
			        data: {id:id,orderByPage:"asc"},
			        dataType: "json",
			        async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;

								serializList = data;

								serializNum = data.length;

								$(".serializeList h1 span").text("已更新"+serializNum+"章");

								var html = "";

								$.each(data, function(i,item) {
									var articleLock = "";
									if (i > 1) {
										articleLock = "articleLock"
									}
									html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
										"<h2>"+item.title+"</h2>"+
										"<p class='sl-date'>2018-03-23</p>"+
										"<p class='sl-read'>2485</p>"+
									"</li>";
								});

								$(".serializeList ul").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			var orderByPage = "asc";
			
			var serializList = []; 
			var serializNum = 0;

			var locationUrl = "";
			var wxtitle = "";
			var wximgUrl = "";
			var wxdesc = "";
			
			$(function(){
				var id = getQueryString("id");
				serializeArticleInfo(id);
				serializeArticleList(id);

				$(".serializeList h1 a").click(function(){
					serializList.reverse();
					var html = "";

					if (orderByPage == "asc") {
						$.each(serializList, function(i,item) {
							var articleLock = "";
							if (i != serializNum-1 && i != serializNum-2) {
								articleLock = "articleLock"
							}
							html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
								"<h2>"+item.title+"</h2>"+
								"<p class='sl-date'>2018-03-23</p>"+
								"<p class='sl-read'>2485</p>"+
							"</li>";
						});
						orderByPage = "desc";
					} else {
						$.each(serializList, function(i,item) {
							var articleLock = "";
							if (i > 1) {
								articleLock = "articleLock"
							}
							html += "<li data-id='"+item.id+"' class='"+articleLock+"'>"+
								"<h2>"+item.title+"</h2>"+
								"<p class='sl-date'>2018-03-23</p>"+
								"<p class='sl-read'>2485</p>"+
							"</li>";
						});
						orderByPage = "asc";
					}

					$(".serializeList ul").html(html);
				})

				$(".serializeList").on("click","li",function(){
					if (!$(this).hasClass("articleLock")) {
						var articleId = $(this).data("id");
						location.href="serializeArticleDetail.html?id="+id+"&articleId="+articleId;
					}
					
				})

				$("body").on("click",".serializeArticleDetail a,.articleLock,.praiseNum",function(){
					more();
				})
			})
		</script>
	</body>
</html>
