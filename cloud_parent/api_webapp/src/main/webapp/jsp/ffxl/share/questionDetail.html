<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>问答详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/global.css?v=1"/>
		<link rel="stylesheet" type="text/css" href="css/QA.css"/>
	</head>
	<body style="padding-bottom: 4.8rem;">
		<div id="downLoadLine">
			<img src="images/wxLogo.png"/>
			<a onclick="more()">下载APP</a>
		</div>
		
		<div class="questionDetail">
			<em class="questionTag"></em>

			<h1></h1>

			<p class="questionInfo"><span></span> | <i></i></p>
			<div>
				<p></p>
			</div>

			<p class="questionData"></p>
		</div>

		<div class="commentList">
			<h1>全部回答（2）</h1>
			<ul>
				<!-- <li>
					<img class="commentHead" src="" alt="">
					<p class="commentName">奔跑的小绵羊</p>
					<p class="commentTime">12:02</p>
					<p class="commentNum">2</p>
					<p class="praiseNum">2</p>
					<div class="commentCont">
						<p>我爸妈天天晚上都特别晚回家，我一个人在家怕，是不知道和谁说，他们好像一点都不关心我在家怕，可是不知道和谁说，他们好像一点都不关心。</p>
					</div>
				</li> -->
			</ul>
		</div>


		<div class="questionBottom">
			<a class="questionFollow">
				<img src="images/questionFollow.png" alt="">
				<p>关注</p>
			</a>
			<a class="questionComment"><img src="images/questionComment.png" alt="">我来解答</a>
		</div>
		
		
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/fastclick.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
		<script src="js/index.js?v=20180115" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">

			function questionDetail(id){
				$.ajax({
			        url: apiUrl+"/vicinage/q_detail",
			        type: "post",
			        data: {id:id},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
								var data = data.data;
								$(".questionDetail .questionTag").text(data.cateValue);
								$(".questionDetail h1").text(data.title);

								var time = ""
								var differTime = new Date().getTime()-data.createDate;
								if (differTime<=86400000) {
									var hours = parseInt(differTime / 1000 / 60 / 60 % 24 , 10); //计算剩余的小时 
									var minutes = parseInt(differTime / 1000 / 60 % 60, 10);//计算剩余的分钟 
									
									if (hours!=0) {
										time = hours+"小时前";
									} else if (minutes!=0) {
										time = minutes+"分钟前";
									} else {
										time = "1分钟前"
									}
								} else {
									var obj = new Date(data.createDate);
									var oYear = obj.getFullYear();
									var oMonth = obj.getMonth()+1;
									var oDate = obj.getDate();
									var oHour = obj.getHours();
									var oMinute = obj.getMinutes();
									
									time = oYear+"."+getzf(oMonth)+"."+getzf(oDate)+" "+getzf(oHour)+":"+getzf(oMinute);
								}

								$(".questionInfo span").text(time);
								var nickName = "";
								if (data.see) {
									nickName = "匿名用户"
								} else {
									nickName = data.nickName;
								}
								$(".questionInfo i").text(nickName);
								$(".questionDetail div p").html(data.content);

								if (data.img != null && data.img != "") {
									var imgs = "";
									if (data.img.indexOf(",") != -1) {
										var imgArr = data.img.split(",");
										for (var i = 0; i < imgArr.length; i++) {
											imgs += "<img src = '"+imgArr[i]+"' />";
										};
									} else {
										imgs = "<img src = '"+data.img+"' />";
									}
									$(".questionDetail div").append(imgs);

								}

								$(".questionDetail .questionData").text(data.lookCount+"人浏览");

								$(".commentList h1").text("全部回答（"+data.ansCount+"）");


								locationUrl = apiUrl+"/jsp/ffxl/share/questionDetail.html?id="+id;
								wxtitle = "邀请你帮忙解答一个问题｜"+data.title;
								wximgUrl= apiUrl+"/jsp/ffxl/share/images/wxShare.png";
								wxdesc = data.content;
								wxShare(locationUrl,wxtitle,wximgUrl,wxdesc);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}


			function answerList(questionId){
				$.ajax({
			        url: apiUrl+"/vicinage/answer_list",
			        type: "post",
			        data: {questionId:questionId},
			        dataType: "json",
			        // async:false,
			        success: function(data) {
			        	if(data.success){
			                if(data.code == "2000"){
			                	var data = data.data;

								var html = "";
								
								$.each(data, function(i,item) {
									var time = ""
									var differTime = new Date().getTime()-item.createDate;
									if (differTime<=86400000) {
										var hours = parseInt(differTime / 1000 / 60 / 60 % 24 , 10); //计算剩余的小时 
										var minutes = parseInt(differTime / 1000 / 60 % 60, 10);//计算剩余的分钟 
										
										if (hours!=0) {
											time = hours+"小时前";
										} else if (minutes!=0) {
											time = minutes+"分钟前";
										} else {
											time = "1分钟前"
										}
									} else {
										var obj = new Date(item.createDate);
										var oYear = obj.getFullYear();
										var oMonth = obj.getMonth()+1;
										var oDate = obj.getDate();
										var oHour = obj.getHours();
										var oMinute = obj.getMinutes();
										
										time = oYear+"."+getzf(oMonth)+"."+getzf(oDate)+" "+getzf(oHour)+":"+getzf(oMinute);
									}


									var imgs = "";
									if (item.img != null && item.img != "") {
										if (item.img.indexOf(",") != -1) {
											var imgArr = item.img.split(",");
											for (var i = 0; i < imgArr.length; i++) {
												imgs += "<img src = '"+imgArr[i]+"' />";
											};
										} else {
											imgs = "<img src = '"+item.img+"' />";
										}
									}

									var headUrl = "";
									var name = "";
									if (item.see) {
										headUrl = apiUrl+"/jsp/ffxl/share/images/anonymous.png";
										name = "匿名用户"
									} else {
										headUrl = item.uHeadUrl;
										name = item.uName;
									}


									html += "<li data-id='"+item.id+"'>"+
										"<img class='commentHead' src='"+headUrl+"' />"+
										"<p class='commentName'>"+name+"</p>"+
										"<p class='commentTime'>"+time+"</p>"+
										"<p class='commentNum'>"+item.replyCount+"</p>"+
										"<p class='praiseNum'>"+item.pariseCount+"</p>"+
										"<div class='commentCont'>"+
											"<p>"+item.content+"</p>"+imgs+
										"</div>"+
									"</li>";
								});

								$(".commentList ul").html(html);

			                }else{
			                	
			                }
			            }
			        }
			    });
			}

			var locationUrl = "";
			var wxtitle = "";
			var wximgUrl = "";
			var wxdesc = "";
			
			$(function(){
				var id = getQueryString("id");
				questionDetail(id);
				answerList(id);


				$(".commentList").on("click","li",function(){
					// var answerId = $(this).data("id");
					// location.href="answerDetail.html?questionId="+id+"&answerId="+answerId;
					more();
				})

				$("body").on("click",".commentNum,.praiseNum,.questionBottom",function(){
					more();
				})
			})
		</script>
	</body>
</html>
