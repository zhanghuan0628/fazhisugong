<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<title>视频详情-飞小凡</title>
	<link rel="stylesheet" href="css/index.css"/>
	<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
	<script src="js/jquery.min.js"></script>

</head>
<body>
<div class="floor">
	<!--<div class="fclose"><img src="../resources/fxf/news-cou-icon1.png"></div>-->
	<div class="flogo"><img src="images/108.png"></div>
	<div class="yanzi">最懂你的青少年心理交流社区</div>
	<a href="#" onclick="more()">下载App </a>
</div>
<div class="media">
	<video id="divd" src="#" controls="controls" style="width:100%;height:4.2rem;">
	您的浏览器不支持该视频播放。
	</video>
</div>
<div class="content_div">
	<div class="media_title">视频标题</div>
	<div class="meddd">
		<span id="riqq">2017-12-15</span><span><img class="gks" src="images/gks.png">观看数：</span><span id="pagev">212</span>
	</div>
	<div id="contentt"  class="contentt">
		冬天要吃甜的，软的，热乎的，粘粘的，第一好吃果饭，第二好吃糍粑，其实糍粑更好吃一些，不过因为果饭只有年三十晚上能吃到，以稀为贵冬天要吃甜的，软的，热乎的，粘粘的，第一好吃果饭，第二好吃糍粑，其实糍粑更好吃一些，不过因为果饭只有年三十晚上能吃到，以稀为贵冬天要吃甜的，软的，热乎的，粘粘的，第一好吃果饭，第二好吃糍粑，其实糍粑更好吃一些，不过因为果饭只有年三十晚上能吃到，以稀为贵
	</div>
</div>
<div class="counselor"  onclick="showDetail()">
	<div class="ched">
		<img id="counselorSrc" src="images/headurl.png">
	</div>
	<div class="ccont">
		<div><span class="ccname">周吉</span><span  id="job">职称</span></div>
		<div class="cbitq"><span>擅长1</span><span>擅长2</span></div>
	</div>
	<div class="abst">咨询师介绍</div>
</div>

<div class="content_div">
	<div class="pinlun" style="border-left-color:#fdf187">精彩评论</div>
	<div id="ans">
	   <div class="answeror">
        <div class="aor">
            <img src="images/headurl.png">
        </div>
        <div class="adate">
            <div>花开半夏</div>
            <div>2017.5</div>
        </div>
        <div class="xzz">
            <img src="images/xzan.png" class="i1">
            <span  class="i2">123</span>
            <img src="images/xxin.png"  class="i3">
            <span class="i4">123</span>
        </div>
    </div>
	
	<div class="aconts">
			从你的全世界路过
		</div>
	<div class="beansc">
		<div><span>楼主</span>回复<span>花开_半夏</span>：只要最后是你，就好。</div>
		<div><span>楼主</span>回复<span>花开_半夏</span>：只要最后是你，就好。</div>
	</div>
	</div>
	<div class="more" onclick="more()"><a href="#" >更多</a></div>
</div>
<script type="text/javascript">
document.documentElement.style.fontSize = window.innerWidth/7.5 + 'px';
var title = "";
var photo="";
var counselorId ="";
var content ="";
$.ajax({
	url : '../fxf_share/get_infos',
	data:{id:getQueryString("id") },
	success:function(res){
		console.log(res)
        var data = eval(res.data);
        var info = data.info; //视频详情
        var answerList = data.answerList;//评论
        var counselor = data.counselor;//咨询师
        title = info.title; //分享使用
        var reTag = /<(?:.|\s)*?>/g;
        content = info.content.replace(reTag,"");//分享使用
        counselorId = counselor.id;
        //咨询师头像
        $("#counselorSrc").attr('src',counselor.headUrl); 
        $("#divd").attr("src",info.mediaSrc);
        $(".media_title").html(info.title);  
        $("#riqq").html(formatData(info.createDate));
        $('#pagev').html(info.pageView) //阅读数
        $(".contentt").html(info.content);
        $("#job").html(counselor.jobName);
        $(".ccname").html(counselor.name)
        var skillHtml='';   
        counselor.skillNameList.forEach(function(skillName,index){
            if(index <3){
                skillHtml+='<span>'+skillName+'</span>'
            }       
        })
        $(".cbitq").html(skillHtml);
        //评论及回答
          var answers='暂无评论';
          answerList.forEach(function (answer) {
              answers+='<div class="answeror"><div class="aor">'
              answers+='<img src="'+answer.headImg+'">'
              answers+='</div>'
              answers+='<div class="adate">'
                      answers+='<div>'+answer.nickName+'</div>'
                      answers+='<div>'+ formatData(answer.answerDate)+'</div>'
              answers+='</div>'
              answers+='<div class="xzz">'
                      answers+='<img src="images/xzan.png" class="i1">'
                      answers+='<span  class="i2">'+answer.praises+'</span>'
                      answers+='<img src="images/xxin.png"  class="i3">'
                      answers+=' <span class="i4">'+answer.childList.length+'</span></div></div>'
            });
          $("#ans").html(answers);
          //分享
          var id =getQueryString("id") ;
          share(id)
          
         

	}
})

 var flg=false;
 console.log("----"+flg);
 document.getElementById("divd").addEventListener("play",function(){  
     if(flg==false){
     var v = $("#pagev").html();
     console.log("b---------"+v+"a---------------"+(v*1+1*1));
     flg= true;
     $("#pagev").html(v*1+1*1)
     addView();
     }
  }  );  

 function addView(){
	 $.ajax({
		    url : '../fxf_share/add_info_page_view',
		    data:{id:getQueryString("id") },
		    success:function(res){
		        
		    }
		})
 }
function formatData(date1){
	  var date = new Date(date1) 
	  return date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
	}
//跳转咨询师主页
 function showDetail(){
      location.href = "../jsp/treatment/shareCounselor/details.jsp?id=" + counselorId;
  }
  
function share(id){
	if( document.getElementById("contentt").getElementsByTagName("img")[0]!=undefined){
	        photo = document.getElementById("contentt").getElementsByTagName("img")[0].src;
	    }else{
	        photo ="http://ffxl.oss-cn-shanghai.aliyuncs.com/fxf/app/108.png";
	    }
    //alert(photo);
    $.ajax({
        type: "POST",
        url : "../jssdk/get_config_param",
        data: {
            requesUrl : location.href.split('#')[0]
            },
        dataType:'json',
        async:false,
        success: function(data){
            console.log(data.data);
            if(data.code == '2000'){    
                console.log(data.data.appId);
                var appId = data.data.appId;
                var timestamp = data.data.timestamp;
                var nonceStr = data.data.nonceStr;
                var signature = data.data.signature;
                
                //alert(appId+"】"+timestamp+"】"+nonceStr+"】"+signature);
                wx.config({
                    debug: false,  
                    appId: appId,  
                    timestamp: timestamp,  
                    nonceStr: nonceStr,  
                    signature: signature,  
                    jsApiList: ['onMenuShareTimeline',
                                'onMenuShareAppMessage',
                                'onMenuShareQQ',
                                'onMenuShareWeibo',
                                'onMenuShareQZone']  
                    });  
                
                wx.ready(function () {
                    wx.checkJsApi({
                        jsApiList: ['onMenuShareTimeline',
                                    'onMenuShareAppMessage',
                                    'onMenuShareQQ',
                                    'onMenuShareWeibo',
                                    'onMenuShareQZone']  , 
                        success: function(res) {
                            console.log(JSON.stringify(res));
                        }
                    });

                    //分享到朋友圈
                    wx.onMenuShareTimeline({
                          title: title, // 分享标题
                          link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/media.html?id="+id,
                          imgUrl: photo, // 分享图标
                          desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                    //分享给朋友
                    wx.onMenuShareAppMessage({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/media.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {
                          alert(name+" ----"+title);
                        }
                    });
                    //分享到QQ
                    wx.onMenuShareQQ({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/media.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                    //分享到QQ空间
                    wx.onMenuShareQZone({
                         title: title, // 分享标题
                         link: "http://ffxlsleep.feifanxinli.com/ffyy/fx/media.html?id="+id,
                         imgUrl: photo, // 分享图标
                         desc: content, // 分享描述
                        success: function () {},
                        cancel: function () {}
                    });
                                        
                    
                    wx.error(function(res){
                        alert("errorMSG:"+res);
                    });
                });
            }else{
                alert(data.message);
            }
        },
        error:function(response, status, err){
            //alert("系统异常");
        }
    });
  }      
</script>
</body>
</html>